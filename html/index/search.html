<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

    <title>搜索</title>
    <link rel="stylesheet" href="../../css/mui.min.css"/>
    <link rel="stylesheet" href="../../css/base.css"/>
    <link rel="stylesheet" href="../../css/iconfont.css"/>
    <link rel="stylesheet" href="../../css/sweetalert2.css"/>
    <link rel="stylesheet" href="../../css/header.css"/>
  <!--  <link rel="stylesheet" href="../../css/index/index.css"/>-->
    <link rel="stylesheet" href="../../css/index/search.css"/>
</head>
<body style="background-color:#fff;">
<div class="layer select">
    <header>
        <i onclick="back()" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></i>
        <input type="text"  placeholder="请输入搜索内容" id="search" />
        <del class="search-btn">搜索</del>
    </header>
    <div class="main">
        <div class="hot_search">
            <div class="hot_tit">
                <span>最近搜索</span>
                <i class="clear-history">清除</i>
            </div>
            <div class="content search-history-list">
                <!--tianco-->
            </div>
        </div>
        <div class="search_lately">
            <!-- 内容-->
            <h2>热门搜索</h2>
            <div class="search_lately_content">
               <!-- <span>高三数学</span>-->
            </div>
        </div>
   <div id="consequence">
       <!-- <div class="list_school" onclick="location.href='./edu_index.html'">
                  <div class="img_box">
                      <img src="../../img/index_school.png" alt="">

                  </div>
                  <div class="right">
                      <em class="clearfix">华南师范大学 <del>1.2km</del></em>

                      <div class="right_center">
                          <em></em> 1&lt;!&ndash;这是什么？&ndash;&gt;
                          &nbsp;&nbsp;&nbsp;&nbsp;<del>高中</del>
                          &nbsp;&nbsp;&nbsp;&nbsp;<del>初中</del>
                      </div>
                      <div class="right_footer">
                          <i class="iconfont icon-zuobiao"></i>
                          <span>广州市天河区中山广州市天河区中山大道西1路</span>
                      </div>
                  </div>
              </div>
       <div class="list_teacher" onclick="location.href='../index/teacher_index.html'">
               <img src="../../img/focus-img1.png" alt="">
               <div class="list_center">
                   <div class="list_center_top clearfix">
                       <span>傅娟 </span><i class="f_right">1.2km</i>
                   </div>
                   <div class="list_center_center clearfix">
                       <em>数学</em>
                       <em>初二</em>
                       <s class="f_right">在线</s>
                   </div>
                   <div class="list_bottom">
                       华南师范大学附属中学
                   </div>
               </div>
           </div>
       <div class="list_course">
           <a href="./index_video.html">
               <img src="../../img/index_edu.png" alt="">
               <div class="ex_right">
                   <div class="ex_top clearfix">
                       <span>主讲：傅娟</span>&nbsp;&nbsp;&nbsp;&nbsp;
                       <em class="f_right"><del>11023</del>人学习</em>
                   </div>
                   <div class="ex_center">
                       2018-07-15  更新第10课时更新第10课时
                   </div>
                   <div class="ex_footer">
                       华南师范大学附属中学师范大学附属中学
                   </div>
               </div>
           </a>
       </div>-->
   </div>
    </div>

</div>
</body>
<script src="../../js/x_rem.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/sweetalert2.js"></script>
<script src="../../js/base.js"></script>
<script src="../../js/back.js"></script>
<script src="../../js/template-web.js"></script>
<script src="../../js/template.js"></script>
<script type="text/template" id="historyTpl">
    {{if list.length ==0}}
    <p>对不起，暂时没有搜索记录！</p>
    {{else}}
    {{each list as value i}}
    <span class="searchList">{{value}}</span>
    {{/each}}
    {{/if}}
</script>
<!--热门搜索的填充-->
<script id="hotSearch" type="text/html">
{{if data.length==0}}

<span>高三数学</span>
{{else}}
    {{each data as value i}}
        <span>{{value}}</span>
    {{/each}}
{{/if}}
</script>
<script type="text/html" id="result">
{{if data.length==0||data==null}}
<div class="no_in">对不起，暂时没有搜索结果</div>
{{else}}
<!--教师-->
{{if data.searchTeacher.length!==0}}
<p> 返回的教师有：</p>
{{each data.searchTeacher as teacher i}}
<div class="list_teacher" onclick="location.href='../index/teacher_index.html'">
    <img src="../../img/focus-img1.png" alt="">
    <div class="list_center">
        <div class="list_center_top clearfix">
            <span>{{teacher.teacher.nickname}} </span><i class="f_right">1.2km</i>
        </div>
        <div class="list_center_center clearfix">
            <em>数学</em>
            <em>初二</em>
            <s class="f_right">在线</s>
        </div>
        <div class="list_bottom">
            {{teacher.teacher.address}}
        </div>
    </div>
</div>
{{/each}}
{{/if}}
<!--学校-->
{{if data.searchSchool.length!==0}}
<p>返回的学校有：</p>
{{each data.searchSchool as school i}}
<div class="list_school" onclick="location.href='./edu_index.html?schoolID={{school.school.schoolId}}'">
    <div class="img_box">
        <img src="../../img/index_school.png" alt="">
    </div>
    <div class="right">
        <em class="clearfix">{{school.school.name}} <del>1.2km</del></em>

        <div class="right_center">
            <em></em> {{school.teacherNum}}<!--这是什么？-->
            &nbsp;&nbsp;&nbsp;&nbsp;<del>高中</del>
            &nbsp;&nbsp;&nbsp;&nbsp;<del>初中</del>
        </div>
        <div class="right_footer">
            <i class="iconfont icon-zuobiao"></i>
            <span>{{school.school.address}}</span>
        </div>
    </div>
</div>


{{/each}}
{{/if}}
<!--课程-->
{{if data.searchCourse.length!==0}}
<p>返回的课程有：</p>
{{each data.searchCourse as course i}}
<div class="list_course">
    <a href="./index_video.html">
        <img src="../../img/index_edu.png" alt="">
        <div class="ex_right">
            <div class="ex_top clearfix">
                <span>主讲：{{course.speaker}}</span>&nbsp;&nbsp;&nbsp;&nbsp;
                <em class="f_right"><del>{{course.StudyCourseNum}}</del>人学习</em>
            </div>
            <div class="ex_center">
                {{time(course.updateTime)}}  更新第{{course.updateNum}}课时
            </div>
            <div class="ex_footer">
                {{course.course.schoolName}}
            </div>
        </div>
    </a>
</div>
{{/each}}
{{/if}}

{{/if}}

</script>
<script>
    $(function(){
        /*热门搜索*/
        myAjax({url:"/search/hot/history",type:"post"},function(data){
            console.log(data);
            //data=data.slice(0,10);
            $(".search_lately_content").html(template('hotSearch',{data:data.data.slice(0,5)}))
            $(".search_lately_content>span").click(function () {
                $("#search").val($(this).text());
            });
        })

        /* 点击搜索按钮，发送请求*/

        /*都会和localStorage   约定一个键  leTaoHistory */
        /*1渲染列表*/
        /*获取*/
        var historyList = getHistoryData();
        /*渲染*/
        $('.search-history-list').html(template('historyTpl',{list:historyList}));
        $('#search').val('');
        $(".searchList").click(function (){
            var text= $(this).text();
            console.log(text);
            $("#search").val(text);
        })
        /*2点击搜索*/
        $(".search-btn").click(function(){

            /*获取关键字*/
            var key = $.trim($('#search').val());
            /*如果用户没有输入*/
            if(!key){
                /*提示*/
                alert("请输入搜索内容");
                return false;
            }else{
                //发送请求
                myAjax({url:"/search/add/history",data:{searchContent:key},type:"post"}, function (data) {
                    console.log(data);
                    //搜索历史
                })
                myAjax({url:"/search/get/search/all",data:{search:key},type:"post"}, function (data) {
                    console.log(data);
                    //搜索全部  教师课程 学校
                    if(data.status==200){
                        template.helper("time",function(date){
                            var time=new Date(date).toLocaleString().replace(/:\d{1,2}$/,' ').substr(5,11).replace("/","-");
                            return time;
                            /* return new Date(parseInt(date) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');*/
                        });
                        // 渲染
                        $("#consequence").html(template("result",data))
                    }
                })
            }
           /* //var city=localStorage.getItem("city");
            function render(data){
                console.log(data);
                //页面重绘
                if(data.code==200){
                   $(".news_list").html(template("searchResult",data));
                }
            }
           // myAjax({url:"/station/searchByKey",data:{city:city,key:key},type:"post"},render);
            myAjax({url:"/station/search",data:{key:key},type:"post"},render);
            */
            /*记录这一次的搜索*/
            var arr = getHistoryData();

            /*1.在正常的10条记录内 正常添加*/
            /*2.已经10条记录了    添加一条 并且 删除最早的一条 */
            /*3.如果有相同记录    添加一条 并且 删除相同的一条 */
            /*是否有相同数据*/
            var isHave = false;
            var haveIndex;
            for(var i = 0 ; i < arr.length ; i ++){
                if(key == arr[i]){
                    isHave = true;
                    haveIndex = i;
                    break;
                }
            }
            if(isHave){
                /*3.如果有相同记录*/
                arr.push(key);
                /*删除*/
                arr.splice(haveIndex,1);
            }else{
                if(arr.length < 5){
                    /*1.在正常的10条*/
                    arr.push(key);
                }else{
                    /*已经10条记录*/
                    arr.push(key);
                    /*清除第一条*/
                    arr.splice(0,1);
                }
            }
            /*存起来*/
            localStorage.setItem('MuHistory',JSON.stringify(arr));
            $("#search").val("");
          // console.log({list:arr});
            $('.search-history-list').html(template('historyTpl',{list:arr.reverse()}));
            /*跳转搜索列表*/
            // location.href = 'searchList.html?key='+key;
        })


        /*3删除记录*/

       /* $('.lt_history').on('click','.mui-icon',function(){
            /!*1.获取索引*!/
            var index = $(this).attr('data-index');
            /!*2.获取数据*!/
            var arr = getHistoryData();
            /!*3.删除数据*!/
            arr.splice(index,1);
            /!*4.存储数据*!/
            localStorage.setItem('MuHistory',JSON.stringify(arr));
            /!*5.重新渲染*!/
            $('.lt_history').html(template('historyTpl',{list:arr}));
        });*/

        /*4清空记录*/
        $(".clear-history").click(function(){
            localStorage.setItem('MuHistory','');
            $('.content').html(template('historyTpl',{list:[]}));
        })
        /*$('.lt_history').on('tap','.fa',function(){
            /!*清空数据*!/
            localStorage.setItem('leTaoHistory','');
            /!*重新渲染*!/
            $('.lt_history').html(template('historyTpl',{list:[]}));
        });*/

    });
    /*获取存储数据*/
    var getHistoryData = function(){
        /*1.约定一个键  leTaoHistory 值存的是json格式的字符串*/
        /*2.通过这个键获取值 如果有就使用 如果没有默认空数组的字符串*/
        var str = localStorage.getItem('MuHistory')||'[]';
        /*3.转成成js数据*/
        var arr = JSON.parse(str);
        /*4.返回js可操作的数组*/
        return arr;
    }
    //


</script>
</html>