<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

    <title>  教务管理</title>

    <link rel="stylesheet" href="../../css/mui.min.css"/>
    <link rel="stylesheet" href="../../css/base.css"/>
    <link rel="stylesheet" href="../../css/sweetalert2.css"/>
    <link rel="stylesheet" href="../../css/iconfont.css"/>
    <link rel="stylesheet" href="../../css/header.css"/>
    <link rel="stylesheet" href="../../css/mine/edu_admin.css"/>
</head>
<body>
<div class="layer">
    <header id="header" class="mui-bar mui-bar-nav">
        <i class="mui-icon mui-icon-left-nav mui-pull-left" onclick="back()"></i>
        <h1 class="mui-title">教务管理</h1>
        <em class="iconfont icon-9" onclick="location.href='edu_common_question.html'"></em>
    </header>
    <div class="main">
        <div id="slider" class="mui-slider ">
            <div style="padding: 0px 0px;">
                <div id="segmentedControl" class="mui-segmented-control">
                    <a class="mui-control-item mui-active" href="#item1">
                        <span>视频上传</span>
                    </a>
                    <a class="mui-control-item" href="#item2">
                        <span>我的视频</span>
                    </a>
                </div>
            </div>
            <!--文件选择按钮-->
            <a class="list_video" href="javascript:;">
                <div id="video_content">
                  <input id="file" type="file" accept="video/*" name="myfile" onchange="UpladFile();" />
                </div>
            </a>
        </div>
        <div class="main_content">
            <!-- //把外层的div 去掉就能正常的跳转了-->
            <!--全部-->
            <div id="item1" class="mui-control-content mui-active">
                <h2>
                    <i>视频列表</i>
                    <em data-type="0">未编辑</em>
                    <em data-type="1">已编辑</em>
                    <em class="active" data-type="2">全部</em>
                </h2>
                <ul class="video_lists">
                    <!--上传未完成-->
                    <li class="no_upload">
                        <div class="load_tit">
                            <span>HD</span>
                            <em id="videoName">0.125555.mov</em>
                            <i class="quit_upload"  onclick="sub();">上传</i>
                            <!--<i class="quit_upload">取消</i>-->
                        </div>
                        <!--进度条-->
                        <div class="el-progress el-progress--line" style="display: block;">
                            <div class="el-progress-bar">
                                <div class="el-progress-bar__outer" style="height:8px;">
                                    <div class="el-progress-bar__inner" style="width: 0%;">
                                    </div>
                                </div>
                            </div>
                            <div class="el-progress__text">0%</div>
                        </div>

                    </li>
                    <li class="upload_success">
                        <div class="load_tit">
                            <span>HD</span>
                           <em>20180716183621.mov -2018/07/16 18:36</em>
                            <i>完成上传</i>
                        </div>
                        <div class="operation">
                            <button class="quit">移除</button>
                            <button class="edit" onclick="location.href='editClass.html'">编入课程</button>
                        </div>

                    </li>
                    <li class="upload_success">
                        <div class="load_tit">
                            <span>HD</span>
                           <em>20180716183621.mov -2018/07/16 18:36</em>
                            <i>完成上传</i>
                        </div>
                        <div class="operation">
                            <button class="remove">移除</button>
                            <button class="haveEditClass">已编入课程</button>
                            <button class="editClass" onclick="location.href='./my_video_class_edit.html'">课程编辑</button>
                        </div>

                    </li>
                    <li class="upload_success">
                        <div class="load_tit">
                            <span>HD</span>
                           <em>20180716183621.mov -2018/07/16 18:36</em>
                            <i>完成上传</i>
                        </div>
                        <div class="operation">
                            <button class="putaway">已上架</button>
                            <button class="editC" onclick="location.href='./my_video_class_edit.html'">课程编辑</button>
                        </div>

                    </li>
                </ul>
            </div>
            <div id="item2" class="mui-control-content ">
                <div class="account_tit">
                    <h2>课程列表</h2>
                    <div class="lesson_status">
                        <em>结课状态</em>
                        <span data-lesson="0" class="active">全部</span>
                        <span data-lesson="1">未结课</span>
                        <span data-lesson="2">已结课</span>
                    </div>
                    <div class="publish_status">
                        <em>发布状态</em>
                        <span data-publish="3" class="active">全部</span>
                        <span data-publish="4">未发布</span>
                        <span data-publish="5">已发布</span>
                    </div>
                </div>
                <div class="my_video_lists">
                    <div class="list">
                        <span>未发布</span>
                        <h4>2018年初二化学上期课堂 <i>未结课</i></h4>
                        <p>
                            <del class="delete iconfont icon-htmal5icon17"></del>
                            华南师范大学附属中学
                            <i>共10课时，<s>2</s> 课时未上架</i></p>
                        <div class="list_b clearfix" onclick="location.href='./editClass.html'">
                        <!--<div class="list_b clearfix" onclick="location.href='./my_video_class_edit.html'">-->
                            <span>最新编辑 2018.07.23</span>
                            <i class="mui-icon mui-icon-forward f_right"></i>
                        </div>
                    </div>
                    <div class="list has_publish">
                        <span>已发布</span>
                        <h4>2018年初二化学上期课堂 <i>未结课</i></h4>
                        <p>
                            <del class="delete iconfont icon-htmal5icon17"></del>
                            华南师范大学附属中学
                            <i>共10课时，<s>2</s> 课时未上架</i></p>
                        <div class="list_b clearfix" onclick="location.href='./editClass.html'">
                            <span>最新编辑 2018.07.23</span>
                            <i class="mui-icon mui-icon-forward f_right"></i>
                        </div>
                    </div>
                </div>

            </div>

        </div>
</div>
</body>
<script src="../../js/mui.min.js"></script>
<script src="../../js/x_rem.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/base.js"></script>
<script src="../../js/back.js"></script>
<script src="../../js/sweetalert2.js"></script>
<script>
    var xhr;//异步请求对象
    var ot; //时间
    var oloaded;//大小
    //上传文件方法
    function UpladFile() {
        var fileObj = document.getElementById("file").files[0]; // js 获取文件对象
        if (fileObj.name) {

            $("#videoName").text(fileObj.name);
        } else {
            alert("请选择文件");
        }

    }
    /*点击提交*/
    function sub(){
        var fileObj = document.getElementById("file").files[0]; // js 获取文件对象
        if(fileObj==undefined||fileObj==""){
            return alert("请选择文件");
        };
//      视频大小判断
        if(fileObj.size>=20*1024*1024){
            return alert("文件过大,请重新选择文件");
        }
        var url = "http://39.104.127.252:8084/pic/file/upload"; // 接收上传文件的后台地址
        var form = new FormData(); // FormData 对象
        form.append("token", _token); // 文件对象
        form.append("file", fileObj); // 文件对象

        xhr = new XMLHttpRequest(); // XMLHttpRequest 对象
        xhr.open("post",url, true); //post方式，url为服务器请求地址，true 该参数规定请求是否异步处理。
        xhr.onload = uploadComplete; //请求完成
        xhr.onerror = uploadFailed; //请求失败
        xhr.upload.onprogress = progressFunction;//【上传进度调用方法实现】
        xhr.upload.onloadstart = function() { //上传开始执行方法
            ot = new Date().getTime(); //设置上传开始时间
            oloaded = 0; //设置上传开始时，以上传的文件大小为0
        };
        xhr.send(form); //开始上传，发送form数据
    }
    //上传进度实现方法，上传过程中会频繁调用该方法
    function progressFunction(evt){
        // event.total是需要传输的总字节，event.loaded是已经传输的字节。如果event.lengthComputable不为真，则event.total等于0
        if(evt.lengthComputable){
            $(".el-progress--line").css("display","block");
            /*进度条显示进度*/
            var bfb=Math.round(evt.loaded / evt.total * 100);
            $(".el-progress-bar__inner").css({"width":bfb+'%',"height":"100%","background":"red"});
            $(".el-progress__text").html(bfb + "%");
        }

        var time = document.getElementById("time");
        var nt = new Date().getTime(); //获取当前时间
        var pertime = (nt - ot) / 1000; //计算出上次调用该方法时到现在的时间差，单位为s
        ot = new Date().getTime(); //重新赋值时间，用于下次计算

        var perload = evt.loaded - oloaded; //计算该分段上传的文件大小，单位b
        oloaded = evt.loaded; //重新赋值已上传文件大小，用以下次计算

        //上传速度计算
        var speed = perload / pertime; //单位b/s
        var bspeed = speed;
        var units = 'b/s'; //单位名称
        if(speed / 1024 > 1) {
            speed = speed / 1024;
            units = 'k/s';
        }
        if(speed / 1024 > 1) {
            speed = speed / 1024;
            units = 'M/s';
        }
        speed = speed.toFixed(1);
        //剩余时间
        var resttime = ((evt.total - evt.loaded) / bspeed).toFixed(1);
        time.innerHTML = '上传速度：' + speed + units + ',剩余时间：' + resttime + 's';
        if(bspeed == 0)
            time.innerHTML = '上传已取消';
    }
    //上传成功响应
    function uploadComplete(evt) {
        //服务端接收完文件返回的结果  注意返回json对象转换为数组
        if(evt.target.responseText){
            var data=JSON.parse(evt.target.responseText)
            console.log("上传成功！");
//          $(".preview").append("<video  controls='' width='100%' autoplay='' name='media'><source src="+data.data+" type='video/mp4'></video>");

        }else{
            alert("上传失败");
        }
    }
    //上传失败
    function uploadFailed(evt) {
        alert("上传失败！");
    }
    $(function () {
        /*点击 视频列表*/
        $("#item1>h2>em").click(function () {
            $(this).addClass("active");
            $(this).siblings().removeClass("active");

        })
        /*点击 结课状态的 发布状态*/
        function status(ele,data){
           ele.click(function () {
                $(this).siblings().removeClass("active");
                $(this).addClass("active");
                console.log($(this).data(data));
            })
        }
        status($(".lesson_status>span"),"lesson");
        status($(".publish_status>span"),"publish");

        /*删除我的视频 */
        $(".delete").click(function () {
            alert(1);
        })
    })
</script>
</html>